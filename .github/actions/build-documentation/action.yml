# GitHub custom Action for documentation generation
#
# Requires a token input that is the GitHub Token
#
# This action generates documentation using techdocs/cli and mkdocks.
# Generated docs are added to the ./site folder
#
# The contents of ./site folder are then published to a `gh-pages` branch.
# GitHub pages are then available for viewing at https://department-of-veterans-affairs.github.io/lighthouse-backstage/
name: Publish Documentation
description: Uses techdocs cli to generate documentation using .md files within the docs folder.
inputs:
  token:
    description: 'github token'
    required: true
    default: ${{ github.token }}
runs:
  using: 'composite'
  steps:
    - uses: actions/setup-node@v2
      with:
            node-version: 14
    - name: setup java
      uses: actions/setup-java@v2
      with:
        distribution: 'zulu'
        java-version: '11'
    - name: download, validate, install plantuml and its dependencies
      run: |
        curl -o plantuml.jar -L http://sourceforge.net/projects/plantuml/files/plantuml.1.2021.4.jar/download
        echo "be498123d20eaea95a94b174d770ef94adfdca18  plantuml.jar" | sha1sum -c -
        mv plantuml.jar /opt/plantuml.jar
        mkdir -p "$HOME/.local/bin"
        echo $'#!/bin/sh\n\njava -jar '/opt/plantuml.jar' ${@}' >> "$HOME/.local/bin/plantuml"
        chmod +x "$HOME/.local/bin/plantuml"
        echo "$HOME/.local/bin" >> $GITHUB_PATH
        sudo apt-get install -y graphviz
      shell: bash
