


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-5.3.2">
    
    
      
        <title>Helm Charts - example-docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#helm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="example-docs" class="md-header-nav__button md-logo" aria-label="example-docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            example-docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Helm Charts
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/department-of-veterans-affairs/lighthouse-backstage/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="example-docs" class="md-nav__button md-logo" aria-label="example-docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    example-docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/department-of-veterans-affairs/lighthouse-backstage/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../local-k8s/" title="Deploy to Local Cluster (K8s/Minikube)" class="md-nav__link">
      Deploy to Local Cluster (K8s/Minikube)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dev-deploy/" title="Deploy to Dev Environment (K8s/Helm)" class="md-nav__link">
      Deploy to Dev Environment (K8s/Helm)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../running-locally/" title="Running Locally" class="md-nav__link">
      Running Locally
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../backstage-update/" title="Backstage Update" class="md-nav__link">
      Backstage Update
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Helm Charts
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Helm Charts" class="md-nav__link md-nav__link--active">
      Helm Charts
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-does-helm-do-for-us" class="md-nav__link">
    What does Helm do for us?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure-of-helm-chart" class="md-nav__link">
    File structure of helm chart
  </a>
  
    <nav class="md-nav" aria-label="File structure of helm chart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#valuesyaml-file" class="md-nav__link">
    values.yaml file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chartyaml" class="md-nav__link">
    Chart.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subcharts" class="md-nav__link">
    Subcharts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-_helperstpl" class="md-nav__link">
    What is _helpers.tpl?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-secrets-with-helm" class="md-nav__link">
    Using Secrets with Helm
  </a>
  
    <nav class="md-nav" aria-label="Using Secrets with Helm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passing-secrets-as-command-line-arguments" class="md-nav__link">
    Passing secrets as command line arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-local-variables" class="md-nav__link">
    Export local variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-ways-to-use-secrets-with-helm" class="md-nav__link">
    Other ways to use secrets with Helm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../allstar/" title="Allstar" class="md-nav__link">
      Allstar
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cypress-troubleshooting/" title="Cypress Troubleshooting" class="md-nav__link">
      Cypress Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../pre-build-validation/" title="Pre-build Validation" class="md-nav__link">
      Pre-build Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      RFCs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="RFCs" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        RFCs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/doc-generator/" title="Doc Generator" class="md-nav__link">
      Doc Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/ci-cd/" title="CI/CD Modifications" class="md-nav__link">
      CI/CD Modifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/catalog-import-research/" title="Catalog Import Research" class="md-nav__link">
      Catalog Import Research
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/node-app-logging/" title="Node App Logging" class="md-nav__link">
      Node App Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/docker-scanning/" title="Docker Scanning" class="md-nav__link">
      Docker Scanning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/enforce-build-performance/" title="Enforce Build Performance" class="md-nav__link">
      Enforce Build Performance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/investigate-esbuild-and-vite/" title="Investigate Esbuild and Vite" class="md-nav__link">
      Investigate Esbuild and Vite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/linting/" title="Linting Rules" class="md-nav__link">
      Linting Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/investigate-pact/" title="Investigate Pact" class="md-nav__link">
      Investigate Pact
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/env-promotion/" title="Environment Promotion" class="md-nav__link">
      Environment Promotion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/custom-actions/" title="Custom Actions" class="md-nav__link">
      Custom Actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/github-access/" title="RFC GitHub Access" class="md-nav__link">
      RFC GitHub Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RFC/google-analytics/" title="Google Analytics" class="md-nav__link">
      Google Analytics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Decision Records
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Decision Records" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Decision Records
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ADR/zero-install/" title="Yarn Zero Install" class="md-nav__link">
      Yarn Zero Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ADR/split-fe-be/" title="Split FE/BE" class="md-nav__link">
      Split FE/BE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ADR/cypress-e2e-tests/" title="Cypress e2e Tests" class="md-nav__link">
      Cypress e2e Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ADR/code-cov/" title="Ignore Backend Code Coverage" class="md-nav__link">
      Ignore Backend Code Coverage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ADR/vite/" title="Vite" class="md-nav__link">
      Vite
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-does-helm-do-for-us" class="md-nav__link">
    What does Helm do for us?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure-of-helm-chart" class="md-nav__link">
    File structure of helm chart
  </a>
  
    <nav class="md-nav" aria-label="File structure of helm chart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#valuesyaml-file" class="md-nav__link">
    values.yaml file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chartyaml" class="md-nav__link">
    Chart.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subcharts" class="md-nav__link">
    Subcharts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-_helperstpl" class="md-nav__link">
    What is _helpers.tpl?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-secrets-with-helm" class="md-nav__link">
    Using Secrets with Helm
  </a>
  
    <nav class="md-nav" aria-label="Using Secrets with Helm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passing-secrets-as-command-line-arguments" class="md-nav__link">
    Passing secrets as command line arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-local-variables" class="md-nav__link">
    Export local variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-ways-to-use-secrets-with-helm" class="md-nav__link">
    Other ways to use secrets with Helm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/department-of-veterans-affairs/lighthouse-backstage/edit/master/docs/helm.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="helm">Helm<a class="headerlink" href="#helm" title="Permanent link">&para;</a></h1>
<h2 id="what-does-helm-do-for-us">What does Helm do for us?<a class="headerlink" href="#what-does-helm-do-for-us" title="Permanent link">&para;</a></h2>
<p>Helm is referred to as a "Kubernetes Package Manager", it is a command line tool that creates and installs Helm Charts. Helm Charts provide us with templated versions of the configuration files that describe our kubernetes deployment. In addition to templates, the Chart contains a set of files that define values that will be combined with the templates to generate our Kubernetes files. Using Helm will allow us to deploy to multiple environments without the need to maintain multiple sets of Kubernetes configuration files.</p>
<ul>
<li><a href="https://helm.sh/docs/chart_template_guide/getting_started/">Helm Docs</a></li>
</ul>
<h2 id="file-structure-of-helm-chart">File structure of helm chart<a class="headerlink" href="#file-structure-of-helm-chart" title="Permanent link">&para;</a></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>.
└── mychart
    ├── Chart.yaml
    ├── values.yaml
    ├── charts/
    └── templates/
        ├── _helpers.tpl
        ├── deployment.yaml
        ├── service.yaml
        ├── ingress.yaml
        ├── configmap.yaml
        └── otherK8smanifestfiles.yaml
</code></pre></div>
</td></tr></table>

<p>The <code>mychart/templates/</code> directory contains templated versions all the yaml files that will be used for our Kubernetes deployment as well as a <code>_helpers.tpl</code> file. Using the <code>helm install</code> CLI will use the templates inconjunction with the <code>Chart.yaml</code> and <code>values.yaml</code> to render the Kubernetes files for deployment.</p>
<h3 id="valuesyaml-file">values.yaml file<a class="headerlink" href="#valuesyaml-file" title="Permanent link">&para;</a></h3>
<p>This file contains the default values for a chart. These values may be overridden by users during helm install or helm upgrade.</p>
<h3 id="chartyaml">Chart.yaml<a class="headerlink" href="#chartyaml" title="Permanent link">&para;</a></h3>
<p>The Chart.yaml file contains a description of the chart. You can access it from within a template. The <code>charts/</code> directory may contain other charts called subcharts. </p>
<h3 id="subcharts">Subcharts<a class="headerlink" href="#subcharts" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://helm.sh/docs/chart_template_guide/subcharts_and_globals/">More information about subcharts</a>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>- A subchart is considered &quot;stand-alone&quot;, which means a subchart can never explicitly depend on its parent chart.
- For that reason, a subchart cannot access the values of its parent.
- A parent chart can override values for subcharts.
- Helm has a concept of global values that can be accessed by all charts.
</code></pre></div>
</td></tr></table></li>
</ul>
<h3 id="what-is-_helperstpl">What is _helpers.tpl?<a class="headerlink" href="#what-is-_helperstpl" title="Permanent link">&para;</a></h3>
<p>Files that being with <code>_</code> inside the <code>templates/</code> directory are not rendered to Kubernetes object definitions, but these files are available everywhere within other chart templates for use. This file is default location for <code>template partials</code>. </p>
<ul>
<li>Create a partial template containing a block of labels
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># templates/_helpers.tpl
{{- define &quot;mychart.labels&quot; }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
{{- end }}
</code></pre></div>
</td></tr></table></li>
<li>Adding the partial template to the template file
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># templates/configmap.yaml
{{- define &quot;mychart.labels&quot; }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
{{- end }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
  {{- template &quot;mychart.labels&quot; }}
data:
  myvalue: &quot;Hello World&quot;
  {{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
  {{- end }}
</code></pre></div>
</td></tr></table></li>
<li>The rendered output:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># Source: templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: running-panda-configmap
  labels:
    generator: helm
    date: 2016-11-02
data:
  myvalue: &quot;Hello World&quot;
  drink: &quot;coffee&quot;
  food: &quot;pizza&quot;
</code></pre></div>
</td></tr></table></li>
</ul>
<h2 id="using-secrets-with-helm">Using Secrets with Helm<a class="headerlink" href="#using-secrets-with-helm" title="Permanent link">&para;</a></h2>
<h3 id="passing-secrets-as-command-line-arguments">Passing secrets as command line arguments<a class="headerlink" href="#passing-secrets-as-command-line-arguments" title="Permanent link">&para;</a></h3>
<p>Currently I am passing secrets as command line arguments when installing helm charts</p>
<p><strong>How this works:</strong>
- First I assigned variable names as values for the following <code><b>key</b>: value</code> pairs in the <code>values.yaml</code> file:</p>
<pre>
# values.yaml
secrets:
    <b>DOCKERCONFIGJSON</b>: ${DOCKERCONFIGJSON}
    <b>GITHUB_TOKEN</b>: ${GITHUB_TOKEN}
</pre>

<ul>
<li>Then these keys are referenced in the <code>deployment.yaml</code>:
<pre></li>
</ul>
<hr />
<p>kind: Secret
type: kubernetes.io/dockerconfigjson
apiVersion: v1
metadata:
  name: {{ include "lighthouse-backstage.fullname" . }}-dockerconfigjson-ghpkgs
  labels: {{- include "lighthouse-backstage.selectorLabels" . | nindent 8 }}
data:
  .dockerconfigjson: {{ .Values.<b>DOCKERCONFIGJSON</b> }}</p>
<hr />
<p>apiVersion: v1
kind: Secret
metadata:
  name: {{ include "lighthouse-backstage.fullname" . }}-secrets
  labels: {{- include "lighthouse-backstage.selectorLabels" . | nindent 8 }}
type: Opaque
data:
GITHUB_TOKEN: {{ .Values.<b>GITHUB_TOKEN</b> }}
</pre></p>
<blockquote>
<p>Note: <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes Secrets</a> have different types. The first secret type is <code>kubernetes.io/dockerconfigjson</code> which is used for a docker config.json file represented as an encoded string. This is used to provide authentication credentials for accessing a container repository to be able to pull images. More information about creating and encoding the json string: <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/</a>. The second secret is a base64 encoded personal access token used by <a href="https://backstage.io/docs/deployment/k8s#creating-the-backstage-instance">Backstage</a>. </p>
</blockquote>
<h3 id="export-local-variables">Export local variables<a class="headerlink" href="#export-local-variables" title="Permanent link">&para;</a></h3>
<p>Now that the environment variables are mapped to keys, and those keys are referenced in <code>templates/deployment.yaml</code>, we need to export the values for these variables
- Create a <code>.env</code> file containing your secrets
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>DOCKERCONFIGJSON=&lt;base64 encoded json string&gt;
GITHUB_TOKEN=&lt;base64 encoded github_token&gt;
POSTGRES_USER=&lt;base64 encoded postgres username&gt;
POSTGRES_PASSWORD=&lt;base64 encoded postgres password&gt;
POSTGRES_DB=&lt;base64 encoded postgres database name&gt;
HOST=&lt;host url&gt;
GH_CLIENT_ID=&lt;GH OAuth Client ID&gt;
GH_CLIENT_SECRET=&lt;GH OAuth Client Secret&gt;
</code></pre></div>
</td></tr></table>
- Export the contents of the file
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>set -o allexport; source .env; set +o allexport
</code></pre></div>
</td></tr></table>
- Set the variables when installing the helm chart
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ helm install backstage-dev helm/lighthouse-backstage/ --debug --values helm/lighthouse-backstage/values.yaml --namespace lighthouse-bandicoot-dev --set DOCKERCONFIGJSON=$DOCKERCONFIGJSON --set GITHUB_TOKEN=$GITHUB_TOKEN --set POSTGRES_USER=$POSTGRES_USER --set POSTGRES_PASSWORD=$POSTGRES_PASSWORD --set POSTGRES_DB=$POSTGRES_DB --set HOST=$HOST --set GH_CLIENT_ID=$GH_CLIENT_ID --set GH_CLIENT_SECRET=$GH_CLIENT_SECRET
</code></pre></div>
</td></tr></table>
- View deployment
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ helm list -n lighthouse-bandicoot-dev
NAME            NAMESPACE                       REVISION        UPDATED                                 STATUS          CHART                           APP VERSION
backstage-dev   lighthouse-bandicoot-dev        1               2021-10-07 07:37:22.4745171 -0700 PDT   deployed        lighthouse-backstage-0.1.0      1.16.0
</code></pre></div>
</td></tr></table></p>
<h3 id="other-ways-to-use-secrets-with-helm">Other ways to use secrets with Helm<a class="headerlink" href="#other-ways-to-use-secrets-with-helm" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/jkroepke/helm-secrets">helm-secrets plugin</a></li>
</ul>
<p>This approach uses SOPS to encrypt a <code>secrets.yaml</code> file and seems to be one of the more popular options I found, it is listed on Helms website as well: <a href="https://helm.sh/docs/community/related/#helm-plugins">https://helm.sh/docs/community/related/#helm-plugins</a></p>
<ul>
<li><a href="https://learn.hashicorp.com/tutorials/vault/kubernetes-sidecar">Hashicorp's Vault</a></li>
</ul>
<p>This is a more "heavy handed" solution. It uses it own set of helm charts to deploy a <code>vault</code> pod and a <code>vault-agent-injector</code> pod to store and inject secrets into our application pods.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../backstage-update/" title="Backstage Update" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Backstage Update
              </div>
            </div>
          </a>
        
        
          <a href="../allstar/" title="Allstar" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Allstar
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.7f4f3c92.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9b3611bd.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>