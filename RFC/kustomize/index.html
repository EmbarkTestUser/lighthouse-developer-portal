


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-5.3.2">
    
    
      
        <title>Kustomize Deployment - example-docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploying-to-development-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="example-docs" class="md-header-nav__button md-logo" aria-label="example-docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            example-docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Kustomize Deployment
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/department-of-veterans-affairs/lighthouse-embark/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="example-docs" class="md-nav__button md-logo" aria-label="example-docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    example-docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/department-of-veterans-affairs/lighthouse-embark/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../local-k8s/" title="Deploy to Local Cluster (K8s/Minikube)" class="md-nav__link">
      Deploy to Local Cluster (K8s/Minikube)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dev-deploy/" title="Deploy to Dev Environment (K8s/Helm)" class="md-nav__link">
      Deploy to Dev Environment (K8s/Helm)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../running-locally/" title="Running Locally" class="md-nav__link">
      Running Locally
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../backstage-update/" title="Backstage Update" class="md-nav__link">
      Backstage Update
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../helm/" title="Helm Charts" class="md-nav__link">
      Helm Charts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../allstar/" title="Allstar" class="md-nav__link">
      Allstar
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cypress-troubleshooting/" title="Cypress Troubleshooting" class="md-nav__link">
      Cypress Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../pre-build-validation/" title="Pre-build Validation" class="md-nav__link">
      Pre-build Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../catalog-entry/" title="Catalog Entry" class="md-nav__link">
      Catalog Entry
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../github-packages/" title="GitHub Packages" class="md-nav__link">
      GitHub Packages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../starter-guide/" title="Starter Guide" class="md-nav__link">
      Starter Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../gha-dependencies/" title="GHA Dependencies" class="md-nav__link">
      GHA Dependencies
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15" checked>
    
    <label class="md-nav__link" for="nav-15">
      RFCs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="RFCs" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        RFCs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../doc-generator/" title="Doc Generator" class="md-nav__link">
      Doc Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ci-cd/" title="CI/CD Modifications" class="md-nav__link">
      CI/CD Modifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../catalog-import-research/" title="Catalog Import Research" class="md-nav__link">
      Catalog Import Research
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../node-app-logging/" title="Node App Logging" class="md-nav__link">
      Node App Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker-scanning/" title="Docker Scanning" class="md-nav__link">
      Docker Scanning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../enforce-build-performance/" title="Enforce Build Performance" class="md-nav__link">
      Enforce Build Performance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../investigate-esbuild-and-vite/" title="Investigate Esbuild and Vite" class="md-nav__link">
      Investigate Esbuild and Vite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linting/" title="Linting Rules" class="md-nav__link">
      Linting Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../investigate-pact/" title="Investigate Pact" class="md-nav__link">
      Investigate Pact
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../env-promotion/" title="Environment Promotion" class="md-nav__link">
      Environment Promotion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom-actions/" title="Custom Actions" class="md-nav__link">
      Custom Actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../github-access/" title="GitHub Access" class="md-nav__link">
      GitHub Access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../google-analytics/" title="Google Analytics" class="md-nav__link">
      Google Analytics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configurable-variables/" title="Configurable Variables" class="md-nav__link">
      Configurable Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../browser-logs/" title="Browser Logs" class="md-nav__link">
      Browser Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../argo-automation/" title="Automation with ArgoCD" class="md-nav__link">
      Automation with ArgoCD
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kustomize Deployment
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Kustomize Deployment" class="md-nav__link md-nav__link--active">
      Kustomize Deployment
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubectl-install" class="md-nav__link">
    Kubectl Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kustomize-install" class="md-nav__link">
    Kustomize Install
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-images" class="md-nav__link">
    Building Images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-images-to-github-packages" class="md-nav__link">
    Push Images to GitHub Packages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-dev-environment" class="md-nav__link">
    Deploy to Dev Environment
  </a>
  
    <nav class="md-nav" aria-label="Deploy to Dev Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-to-lightkeeper" class="md-nav__link">
    Login to Lightkeeper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-environment-variables" class="md-nav__link">
    Setting Up Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-kubernetes-resources-with-kustomize" class="md-nav__link">
    Generate Kubernetes Resources with Kustomize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-deployment" class="md-nav__link">
    Verify Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-resources" class="md-nav__link">
    Deleting resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../feature-flags/" title="Feature Flags" class="md-nav__link">
      Feature Flags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configure-timeouts/" title="Configure Timeouts" class="md-nav__link">
      Configure Timeouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../github-app-auth/" title="GitHub App POC" class="md-nav__link">
      GitHub App POC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Decision Records
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Decision Records" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Decision Records
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/zero-install/" title="Yarn Zero Install" class="md-nav__link">
      Yarn Zero Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/split-fe-be/" title="Split FE/BE" class="md-nav__link">
      Split FE/BE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/cypress-e2e-tests/" title="Cypress e2e Tests" class="md-nav__link">
      Cypress e2e Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/code-cov/" title="Ignore Backend Code Coverage" class="md-nav__link">
      Ignore Backend Code Coverage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/vite/" title="Vite" class="md-nav__link">
      Vite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/github-packages/" title="GitHub Packages" class="md-nav__link">
      GitHub Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/twelve-factor-app/" title="Twelve Factor App" class="md-nav__link">
      Twelve Factor App
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/image-signing/" title="Image Signing" class="md-nav__link">
      Image Signing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ADR/code-coverage/" title="Unit Test Coverage" class="md-nav__link">
      Unit Test Coverage
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubectl-install" class="md-nav__link">
    Kubectl Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kustomize-install" class="md-nav__link">
    Kustomize Install
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-images" class="md-nav__link">
    Building Images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-images-to-github-packages" class="md-nav__link">
    Push Images to GitHub Packages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-dev-environment" class="md-nav__link">
    Deploy to Dev Environment
  </a>
  
    <nav class="md-nav" aria-label="Deploy to Dev Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#login-to-lightkeeper" class="md-nav__link">
    Login to Lightkeeper
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-environment-variables" class="md-nav__link">
    Setting Up Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-kubernetes-resources-with-kustomize" class="md-nav__link">
    Generate Kubernetes Resources with Kustomize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-deployment" class="md-nav__link">
    Verify Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-resources" class="md-nav__link">
    Deleting resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/department-of-veterans-affairs/lighthouse-embark/edit/master/docs/RFC/kustomize.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="deploying-to-development-environment">Deploying to Development Environment<a class="headerlink" href="#deploying-to-development-environment" title="Permanent link">&para;</a></h1>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<h3 id="kubectl-install">Kubectl Install<a class="headerlink" href="#kubectl-install" title="Permanent link">&para;</a></h3>
<blockquote>
<p>If you don't have <code>kubectl</code> you'll need to install it:</p>
</blockquote>
<ul>
<li>Install on <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">Linux</a></li>
<li>Install on <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/">Mac</a></li>
<li>Install on <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/">Windows</a></li>
</ul>
<h3 id="kustomize-install">Kustomize Install<a class="headerlink" href="#kustomize-install" title="Permanent link">&para;</a></h3>
<blockquote>
<p>If you don't have <code>kustomize</code> you'll need to install it:</p>
</blockquote>
<ul>
<li>Documentation for <a href="https://kubectl.docs.kubernetes.io/installation/kustomize/">installing kustomize</a></li>
</ul>
<h2 id="building-images">Building Images<a class="headerlink" href="#building-images" title="Permanent link">&para;</a></h2>
<ul>
<li>Navigate to Root Directory</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ cd /workspaces/lighthouse-backstage
</code></pre></div>
</td></tr></table>

<ul>
<li>Install Dependencies &amp; Run Typescript Compiler</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ yarn install --frozen-lockfile &amp;&amp; yarn tsc
</code></pre></div>
</td></tr></table>

<ul>
<li>Verify app-config.dev.yaml has the correct values</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># app-config.dev.yaml
app:
  title: Embark Developer Portal
  baseUrl: https://dev.devportal.name
...

backend:
  baseUrl: https://dev.devportal.name
  listen:
    port: 7007
  csp:
    connect-src: [&quot;&#39;self&#39;&quot;, &#39;http:&#39;, &#39;https:&#39;]
  cors:
    origin: https://dev.devportal.name
    methods: [GET, POST, PUT, DELETE]
    credentials: true
  cache:
    # TODO: update to use memcache in production  https://backstage.io/docs/overview/architecture-overview#cache
    store: memory
  database:
    client: pg
    connection:
      host: ${DEV_POSTGRES_SERVICE_HOST}
      port: ${DEV_POSTGRES_SERVICE_PORT}
      user: ${POSTGRES_USER}
      password: ${POSTGRES_PASSWORD}

...
auth:
  environment: development
  providers:
    github:
      development:
        clientId: ${GH_CLIENT_ID}
        clientSecret: ${GH_CLIENT_SECRET}
</code></pre></div>
</td></tr></table>

<ul>
<li>Build Static Assets</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ yarn build
</code></pre></div>
</td></tr></table>

<ul>
<li>Determine commit sha you want to tag images with<ul>
<li>Replace <code>&lt;commit-sha&gt;</code> below with the commit sha</li>
<li>The commit sha used to tag images is prefixed with "sha-" (i.e. sha-47915d626f95e5b620636376c8adf29ec734...)</li>
</ul>
</li>
</ul>
<ul>
<li>Create Image for Backend Container</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ docker build --tag ghcr.io/ghcr.io/department-of-veterans-affairs/lighthouse-backstage/backend:&lt;commit-sha&gt; --tag ghcr.io/department-of-veterans-affairs/lighthouse-backstage/backend:latest -f Dockerfile.backend .
</code></pre></div>
</td></tr></table>

<ul>
<li>Create Image for Frontend Container</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ docker build --tag ghcr.io/ghcr.io/department-of-veterans-affairs/lighthouse-backstage/frontend:&lt;commit-sha&gt; --tag ghcr.io/department-of-veterans-affairs/lighthouse-backstage/frontend:latest -f Dockerfile.frontend .
</code></pre></div>
</td></tr></table>

<h2 id="push-images-to-github-packages">Push Images to GitHub Packages<a class="headerlink" href="#push-images-to-github-packages" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Login to <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry">ghcr.io with PAT</a></p>
<ul>
<li>Create environment variable with your PAT</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ export CR_PAT=&lt;YOUR_TOKEN&gt;
</code></pre></div>
</td></tr></table>

<ul>
<li>Login to ghcr.io with your GitHub username</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ echo $CR_PAT | docker login ghcr.io -u &lt;USERNAME&gt; --password-stdin
&gt; Login Succeeded
</code></pre></div>
</td></tr></table>

</li>
</ul>
<ul>
<li>Push the Images to the Container Registry</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ docker push --all-tags ghcr.io/department-of-veterans-affairs/lighthouse-backstage/backend:latest
</code></pre></div>
</td></tr></table>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ docker push --all-tags ghcr.io/department-of-veterans-affairs/lighthouse-backstage/frontend:latest
</code></pre></div>
</td></tr></table>

<ul>
<li>Verify the images were pushed by checking when the frontend/backend images were last published on the <a href="https://github.com/orgs/department-of-veterans-affairs/packages?repo_name=lighthouse-backstage">Lighthouse-Backstage repository</a></li>
</ul>
<h2 id="deploy-to-dev-environment">Deploy to Dev Environment<a class="headerlink" href="#deploy-to-dev-environment" title="Permanent link">&para;</a></h2>
<h3 id="login-to-lightkeeper">Login to Lightkeeper<a class="headerlink" href="#login-to-lightkeeper" title="Permanent link">&para;</a></h3>
<ul>
<li>Login to Lightkeeper</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ lightkeeper login
Go here to complete your login: https://...
Login Successful!
</code></pre></div>
</td></tr></table>

<ul>
<li>Set up kube config</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ lightkeeper create clusterconfig nonprod &gt; ~/.kube/config
</code></pre></div>
</td></tr></table>

<blockquote>
<p>Note: if using Codespaces then you cannot install Lightkeeper. To work around this, you can set your kube config locally using the steps above and then copy the config to your Codespaces. In Codespaces, you can make a new <code>.kube</code> directory in <code>~/</code> and then make a new file inside <code>~/.kube/</code> called <code>config</code>. Inside <code>~/.kube/config</code> you can copy the contents of your local <code>~/.lightkeeper/config</code> file.</p>
</blockquote>
<h3 id="setting-up-environment-variables">Setting Up Environment Variables<a class="headerlink" href="#setting-up-environment-variables" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Note: To pull the image, Kubernetes will need authorization for GitHub. One way to verify you have authorization is to create an encoded dockerconfigjson secret using a Personal Access Token. The encoded dockerconfigjson string will be used to create a built in Kubernetes secret type called <code>kubernetes.io/dockerconfigjson</code>. More information about creating and encoding the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">dockerconfigjson string</a></p>
</blockquote>
<ul>
<li>
<p>Creating a DOCKERCONFIGJSON string</p>
<ul>
<li>First make a PAT with the permission to <code>read</code> access for repositories</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ echo -n &quot;&lt;github_username&gt;:&lt;github_pat&gt;&quot; | base64
</code></pre></div>
</td></tr></table>

<ul>
<li>The above command will create an <encoded_auth_string>, with the encoded auth string run:</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ echo -n  &#39;{&quot;auths&quot;:{&quot;ghcr.io&quot;:{&quot;auth&quot;:&quot;&lt;encoded_auth_string&gt;&quot;}}}&#39; | base64
</code></pre></div>
</td></tr></table>

<ul>
<li>This will output the <encoded_dockerjsonconfig_string> which you can then add to the <code>.env</code> file:</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>DOCKERCONFIGJSON=&lt;encoded_dockerjsonconfig_string&gt;
</code></pre></div>
</td></tr></table>

</li>
</ul>
<ul>
<li>
<p>Create Environment Variables for Secrets</p>
<ul>
<li>Create <code>.env</code> file with your environment variables; you will need to set all of these variables in order for the deployment to work.</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>DOCKERCONFIGJSON=&lt;base64 encoded json string&gt;
GH_TOKEN=&lt;github_token&gt;
GH_CLIENT_ID=&lt;GH OAuth Client ID&gt;
GH_CLIENT_SECRET=&lt;GH OAuth Client Secret&gt;
HOST=dev.devportal.name
BASE_URL=https://dev.devportal.name
GATEWAY=istio-system/dev-devportal-name-gateway
NONPROD=true
DEPLOY_ENV=dev
COMMIT_SHA=&lt;commit sha used to tag image or &quot;latest&quot;*&gt;
</code></pre></div>
</td></tr></table>

<blockquote>
<ul>
<li>If you manually build, push, and tag the image with "latest", using "latest" as the image tag for the deployment can work as a temporary fix but it is preferable to use something more unique like a commit sha. The "latest" tag changes frequently due to the CI workflow so this may cause the containers to crash by pulling an image definition that deployment may not be configured to use.</li>
</ul>
</blockquote>
<ul>
<li>Export file contents</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>set -o allexport; source .env; set +o allexport
</code></pre></div>
</td></tr></table>

</li>
</ul>
<h3 id="generate-kubernetes-resources-with-kustomize">Generate Kubernetes Resources with Kustomize<a class="headerlink" href="#generate-kubernetes-resources-with-kustomize" title="Permanent link">&para;</a></h3>
<ul>
<li>Once the <code>.env</code> file is created move it to the <code>deployment/scripts</code> directory</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ cp .env deployments/scripts/
</code></pre></div>
</td></tr></table>

<ul>
<li>Create the environment specific resource files for the deployment using the <code>env-config-secrets.sh</code> file</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ chmod +x deployment/scripts/env-config-secrets.sh 
$ ./env-config-secrets.sh
</code></pre></div>
</td></tr></table>

<blockquote>
<p>This script will create a new directory called <code>overlays</code> containing the <code>dev</code> directory. Inside the <code>dev</code> directory will be the kustomiation file, configmaps, secrets, and any patch files using the appropriate environment variables. This overlay will combine with the base kustomize files to create the deployment.</p>
</blockquote>
<ul>
<li>Deploy the application by running the <code>kustomize build</code> to output the generated files as an input for the <code>kubectl apply</code> command:</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ kustomize build deployment/overlays/dev | kubectl apply -f -
</code></pre></div>
</td></tr></table>

<h3 id="verify-deployment">Verify Deployment<a class="headerlink" href="#verify-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>Through Terminal</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ kubectl get deployments -n lighthouse-bandicoot-dev
NAME                             READY   UP-TO-DATE   AVAILABLE   AGE
dev-backend                       1/1     1            1           9m59s
dev-frontend                      1/1     1            1           9m59s
dev-postgres                      1/1     1            1           9m58s
</code></pre></div>
</td></tr></table>

<ul>
<li>Visit <a href="https://dev.devportal.name">https://dev.devportal.name</a> to view the running application</li>
</ul>
<h3 id="deleting-resources">Deleting resources<a class="headerlink" href="#deleting-resources" title="Permanent link">&para;</a></h3>
<ul>
<li>To manually delete the deployment and all of the resources that were created:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ kustomize build deployment/overlays/dev | kubectl delete -f -
</code></pre></div>
</td></tr></table></li>
</ul>
<blockquote>
<p>Note: The command above to delete resources only works if all of the resources described in the path provided to <code>kustomize build</code> have the same name that they were deployed with. So if you deploy then modify any of the kubernetes resource files in a way that changes the name of a resource not all of the resources will be deleted. You would need to manual find those resources using <code>kubectl get &lt;resource_type&gt;</code> and delete with <code>kubectl delete &lt;resource_type&gt;/&lt;resource_name&gt;</code>.</p>
</blockquote>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../argo-automation/" title="Automation with ArgoCD" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Automation with ArgoCD
              </div>
            </div>
          </a>
        
        
          <a href="../feature-flags/" title="Feature Flags" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Feature Flags
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.7f4f3c92.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9b3611bd.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>