


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-5.3.2">
    
    
      
        <title>Deploy Local K8s Cluster - example-docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploying-backstage-to-local-kubernetes-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="example-docs" class="md-header-nav__button md-logo" aria-label="example-docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            example-docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Deploy Local K8s Cluster
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/department-of-veterans-affairs/lighthouse-backstage/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="example-docs" class="md-nav__button md-logo" aria-label="example-docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    example-docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/department-of-veterans-affairs/lighthouse-backstage/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../running-locally/" title="Running Locally" class="md-nav__link">
      Running Locally
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../backstage-update/" title="Backstage Update" class="md-nav__link">
      Backstage Update
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deploy Local K8s Cluster
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Deploy Local K8s Cluster" class="md-nav__link md-nav__link--active">
      Deploy Local K8s Cluster
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#using-minikube-and-kubernetes" class="md-nav__link">
    Using minikube and Kubernetes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-app-configyaml-for-postgres-service" class="md-nav__link">
    Configure app-config.yaml for postgres service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-images-for-minikube" class="md-nav__link">
    Create images for minikube
  </a>
  
    <nav class="md-nav" aria-label="Create images for minikube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modify-dockerignore" class="md-nav__link">
    Modify .dockerignore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-image-for-backend-container" class="md-nav__link">
    Build image for backend container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-image-for-frontend-container" class="md-nav__link">
    Build image for frontend container
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-up-minikube" class="md-nav__link">
    Start up minikube
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-images-for-minikube" class="md-nav__link">
    Load Images for minikube
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-k8s-dashboard" class="md-nav__link">
    View K8s Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-kubernetes-secrets" class="md-nav__link">
    Configure Kubernetes Secrets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-kubernetes-deploymentsservices" class="md-nav__link">
    Create Kubernetes Deployments/Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expose-and-view-the-application-with-minikube-tunnel" class="md-nav__link">
    Expose and View the Application with minikube tunnel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-pulumi-to-deploy-fe-to-kubernetes" class="md-nav__link">
    Running Pulumi to Deploy FE to Kubernetes
  </a>
  
    <nav class="md-nav" aria-label="Running Pulumi to Deploy FE to Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#through-codespaces" class="md-nav__link">
    Through Codespaces
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../allstar/" title="Allstar" class="md-nav__link">
      Allstar
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      RFCs and decision records
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="RFCs and decision records" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        RFCs and decision records
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../rfc-doc-generator/" title="RFC Doc Generator" class="md-nav__link">
      RFC Doc Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../zero-install-adr/" title="Yarn Zero Install(ADR)" class="md-nav__link">
      Yarn Zero Install(ADR)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rfc-ci-cd/" title="RFC CI/CD Modifications" class="md-nav__link">
      RFC CI/CD Modifications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#using-minikube-and-kubernetes" class="md-nav__link">
    Using minikube and Kubernetes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-app-configyaml-for-postgres-service" class="md-nav__link">
    Configure app-config.yaml for postgres service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-images-for-minikube" class="md-nav__link">
    Create images for minikube
  </a>
  
    <nav class="md-nav" aria-label="Create images for minikube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modify-dockerignore" class="md-nav__link">
    Modify .dockerignore
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-image-for-backend-container" class="md-nav__link">
    Build image for backend container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-image-for-frontend-container" class="md-nav__link">
    Build image for frontend container
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-up-minikube" class="md-nav__link">
    Start up minikube
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-images-for-minikube" class="md-nav__link">
    Load Images for minikube
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-k8s-dashboard" class="md-nav__link">
    View K8s Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-kubernetes-secrets" class="md-nav__link">
    Configure Kubernetes Secrets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-kubernetes-deploymentsservices" class="md-nav__link">
    Create Kubernetes Deployments/Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expose-and-view-the-application-with-minikube-tunnel" class="md-nav__link">
    Expose and View the Application with minikube tunnel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-pulumi-to-deploy-fe-to-kubernetes" class="md-nav__link">
    Running Pulumi to Deploy FE to Kubernetes
  </a>
  
    <nav class="md-nav" aria-label="Running Pulumi to Deploy FE to Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#through-codespaces" class="md-nav__link">
    Through Codespaces
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/department-of-veterans-affairs/lighthouse-backstage/edit/master/docs/local-k8s.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="deploying-backstage-to-local-kubernetes-cluster">Deploying Backstage to local Kubernetes Cluster<a class="headerlink" href="#deploying-backstage-to-local-kubernetes-cluster" title="Permanent link">&para;</a></h1>
<h2 id="using-minikube-and-kubernetes">Using minikube and Kubernetes<a class="headerlink" href="#using-minikube-and-kubernetes" title="Permanent link">&para;</a></h2>
<p><strong>Prerequisites</strong></p>
<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">Install Minikube</a></li>
<li>Install Docker Desktop: <a href="https://docs.docker.com/docker-for-mac/install/">Mac</a>, <a href="https://docs.docker.com/docker-for-windows/install/">Windows</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/">Install Kubectl</a></li>
</ul>
<h2 id="configure-app-configyaml-for-postgres-service">Configure app-config.yaml for postgres service<a class="headerlink" href="#configure-app-configyaml-for-postgres-service" title="Permanent link">&para;</a></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    connection:
      host: ${POSTGRES_SERVICE_HOST}
      port: ${POSTGRES_SERVICE_PORT}
      user: ${POSTGRES_USER}
      password: ${POSTGRES_PASSWORD}
</code></pre></div>
</td></tr></table>

<h2 id="create-images-for-minikube">Create images for minikube<a class="headerlink" href="#create-images-for-minikube" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Note: if you already have images in a container registery it is much quicker to use those directly, but if you're making changes locally you'll need to rebuild the images with your new changes and pass those to minikube.</p>
</blockquote>
<h3 id="modify-dockerignore">Modify .dockerignore<a class="headerlink" href="#modify-dockerignore" title="Permanent link">&para;</a></h3>
<ul>
<li>Change .dockerignore to only include these lines:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>node_modules
packages/*/node_modules
</code></pre></div>
</td></tr></table></li>
</ul>
<h3 id="build-image-for-backend-container">Build image for backend container<a class="headerlink" href="#build-image-for-backend-container" title="Permanent link">&para;</a></h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>yarn build &amp;&amp; yarn build-image 
</code></pre></div>
</td></tr></table>

<h3 id="build-image-for-frontend-container">Build image for frontend container<a class="headerlink" href="#build-image-for-frontend-container" title="Permanent link">&para;</a></h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>docker build . -f Dockerfile.dockerbuild --tag frontend
</code></pre></div>
</td></tr></table>

<h2 id="start-up-minikube">Start up minikube<a class="headerlink" href="#start-up-minikube" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Note: Need to have Docker running for minikube to be able to use docker driver
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>minikube start --driver=docker
</code></pre></div>
</td></tr></table></p>
</blockquote>
<h2 id="load-images-for-minikube">Load Images for minikube<a class="headerlink" href="#load-images-for-minikube" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Note: Only need to do this if you are rebuilding images locally</p>
</blockquote>
<ul>
<li>Check the image name or image ID you want to load to minikube with: 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>docker images
</code></pre></div>
</td></tr></table></li>
<li>Load the images with:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>minikube image load &lt;IMAGE_NAME or IMAGE_ID&gt;
</code></pre></div>
</td></tr></table></li>
<li>Optional: you can verify minikube has access to the local image by checking its docker-env by opening a new terminal and running the commands below. If you don't see the image in the list, then you'll need to load it again or wait for it to finish loading.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>eval $(minikube docker-env) &amp;&amp; docker images
</code></pre></div>
</td></tr></table></li>
<li>When you're done, be sure to close this terminal or keep track of which terminal this is so you don't accidentally run commands using the docker daemon inside of the VM minikube uses.</li>
</ul>
<h2 id="view-k8s-dashboard">View K8s Dashboard<a class="headerlink" href="#view-k8s-dashboard" title="Permanent link">&para;</a></h2>
<ul>
<li>Open a new terminal and run: 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>minikube dashboard
</code></pre></div>
</td></tr></table></li>
</ul>
<h2 id="configure-kubernetes-secrets">Configure Kubernetes Secrets<a class="headerlink" href="#configure-kubernetes-secrets" title="Permanent link">&para;</a></h2>
<ul>
<li>First you must encode the token value with base64: 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>echo -n &quot;token_string_here&quot; | base64
</code></pre></div>
</td></tr></table></li>
<li>Copy the encoded value and edit <code>/k8s/backstage-secrets.yaml</code> to include the encoded token value:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  GITHUB_TOKEN: &lt;BASE64_ENCODED_GITHUB_TOKEN&gt;
</code></pre></div>
</td></tr></table></li>
</ul>
<h2 id="create-kubernetes-deploymentsservices">Create Kubernetes Deployments/Services<a class="headerlink" href="#create-kubernetes-deploymentsservices" title="Permanent link">&para;</a></h2>
<ul>
<li>To create your Kubernetes deployments and services run:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>kubectl apply -f k8s
</code></pre></div>
</td></tr></table></li>
<li>Now you can check your deployments, pods, and services using the minikube dashboard.</li>
</ul>
<h2 id="expose-and-view-the-application-with-minikube-tunnel">Expose and View the Application with minikube tunnel<a class="headerlink" href="#expose-and-view-the-application-with-minikube-tunnel" title="Permanent link">&para;</a></h2>
<ul>
<li>Open a new terminal and start minikube tunnel
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ minikube tunnel
</code></pre></div>
</td></tr></table></li>
<li>In a separate terminal, check the service's external ip
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ kubectl get svc
NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE
backstage-svc   LoadBalancer   10.96.231.234    127.0.0.1     3000:30197/TCP,7000:30343/TCP   3s
postgres     ClusterIP      10.108.231.136   &lt;none&gt;        5432/TCP                        2m6s
</code></pre></div>
</td></tr></table></li>
<li>View the application running at <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a></li>
</ul>
<p><strong>Caveats</strong>
This deployment creates 2 pods: one pod has a single container for the postgres db, and the second pod has 2 containers: one container for the frontend and another container for the backend. Right now with this configuration, <code>backstage-svc</code> is created as a LoadBalancer service so it is designated its own IP address that can be exposed with <code>minikube tunnel</code>. Running the command <code>minikube tunnel</code> creates a network route from the host to the service CIDR of the cluster using the cluster's IP address as a gateway. This exposes the external IP directly to any process running on the host operating system. </p>
<h2 id="running-pulumi-to-deploy-fe-to-kubernetes">Running Pulumi to Deploy FE to Kubernetes<a class="headerlink" href="#running-pulumi-to-deploy-fe-to-kubernetes" title="Permanent link">&para;</a></h2>
<h3 id="through-codespaces">Through Codespaces<a class="headerlink" href="#through-codespaces" title="Permanent link">&para;</a></h3>
<ol>
<li>Switch <code>.devcontainer</code> with <code>.pulumidevcontainer</code><ul>
<li>Run <code>yarn swap-codespaces</code> from the root directory to swap devcontainers</li>
<li>If a <code>.pulumidevcontainer</code> is present, this script will rename <code>.devcontainer</code> to <code>.devcontainer_main</code> and rename <code>.pulumidevcontainer</code> to <code>.devcontainer</code></li>
<li>If there is no <code>.pulumidevcontainer</code>, then the script will rename <code>.devcontainer</code> to <code>.pulumidevcontainer</code> and rename <code>.devcontainer_main</code> to <code>.devcontainer</code></li>
<li>Note: Changing the configuration of the Codespaces container will require the Codespaces container to be rebuilt. <strong>Rebuilding your container will delete any current changes you've made to the container</strong></li>
</ul>
</li>
<li>Rebuild the Codespaces container<ul>
<li>Use the Command Palette or the Codespaces extension to rebuild the container with the new <code>.devcontainer</code></li>
</ul>
</li>
<li>Start Up Pulumi<ul>
<li>Run <code>yarn pulumi</code> from the root directory to use the Pulumi start up script</li>
<li>This script will check if minikube is running, check if a frontend image is created and create a frontend image if it doesn't exist. Finally, the script will run the pulumi start up commands to generate &amp; apply k8s manifest files and then forward ports with <code>kubectl</code> </li>
<li>After the script finishes, you should be able to see the FE running at localhost:3000</li>
<li>Note: this will require creating a Pulumi account </li>
</ul>
</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../backstage-update/" title="Backstage Update" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Backstage Update
              </div>
            </div>
          </a>
        
        
          <a href="../allstar/" title="Allstar" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Allstar
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.7f4f3c92.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9b3611bd.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>